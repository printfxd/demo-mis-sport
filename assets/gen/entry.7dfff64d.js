const I={setScale(e){return this.SACLE=e,this.FACTOR=-100/e,this},setImg(e){if(!e)throw new Error("should give imgEl");this.detach(),this.imgEl=e,this.parent=e.parentNode;const t={onMove:({clientX:i,clientY:s})=>{let n=(i-this.parent.offsetLeft)/this.parent.offsetWidth,u=(s-this.parent.offsetTop)/this.parent.offsetHeight;this.imgEl.style.transform=`scale(${this.SACLE}) translate(${n*this.FACTOR}%,${u*this.FACTOR}%)`},onEnd:()=>{this.imgEl.style.transform="scale(1) translate(0)"}},o=({onStart:i,onMove:s,onEnd:n})=>{const u=r=>{i(),s&&r instanceof TouchEvent&&s(r)},f=r=>{if(r instanceof TouchEvent){r.preventDefault();const v=r.changedTouches;v.length&&s(v[0])}else s(r)},h=()=>n();return{touch(r){return this.detach(),this.el=r,i&&r.addEventListener("touchstart",u,{passive:!0}),s&&r.addEventListener("touchmove",f),n&&r.addEventListener("touchend",h,{passive:!0}),this},mouse(r){return this.detach(),this.el=r,i&&r.addEventListener("mouseenter",u),s&&r.addEventListener("mousemove",f),n&&r.addEventListener("mouseleave",h),this},detach(){if(this.el){const r=this.el;r.removeEventListener("touchstart",u),r.removeEventListener("touchmove",f),r.removeEventListener("touchend",h),r.removeEventListener("mouseenter",u),r.removeEventListener("mousemove",f),r.removeEventListener("mouseleave",h),this.el=null}return this.act=null,this}}};return this.handlers={load:i=>this.onImgLoad(i),touch:o(t).touch(this.parent),mouse:o(t).mouse(this.parent)},e.style.transformOrigin="left top",e.addEventListener("load",this.handlers.load),this},onImgLoad(e){const{clientWidth:t,clientHeight:o}=e.target;this.w=t,this.h=o},detach(){return this.parent&&(this.handlers.touch.detach(),this.handlers.mouse.detach(),this.parent=null),this.imgEl&&(this.imgEl.removeEventListener("load",this.handlers.load),this.imgEl=null),this.handlers=null,this.w=null,this.h=null,this}},j=(e,t)=>{var o=typeof t=="function",i=e("body");e(".gallery").on("click","a",function(s){var n=e(this),u=n.parents(".gallery"),f=u.children(".modal"),h=f.find("img"),r=n.attr("href");if(r.match(/\.(jpg|gif|png|mp4)$/)){if(s.preventDefault(),s.stopPropagation(),o){t(s);return}f[0]._locked||(f[0]._locked=!0,h.attr("src",r),f.addClass("visible"),f.focus(),setTimeout(function(){f[0]._locked=!1},600))}}).on("click",".modal",function(s){var n=e(this),u=n.find("img");n[0]._locked||n.hasClass("visible")&&(s.stopPropagation(),n[0]._locked=!0,n.removeClass("loaded"),setTimeout(function(){n.removeClass("visible"),setTimeout(function(){u.attr("src",""),n[0]._locked=!1,i.focus()},475)},125))}).on("keypress",".modal",function(s){var n=e(this);s.keyCode==27&&n.trigger("click")}).on("mouseup mousedown mousemove",".modal",function(s){s.stopPropagation()}).prepend('<div class="modal" tabIndex="-1"><div class="inner"><img src="" /></div></div>').find("img").on("load",function(){var s=e(this),n=s.parents(".modal");setTimeout(function(){n.hasClass("visible")&&n.addClass("loaded")},275)})},S=(e,t)=>e&&(t(e)?e:S(e.parentNode,t)),N=e=>{const t=e.target;if(!t)return;const o=t.dataset.sizes.split(",");document.querySelectorAll(".mine-circle-fill").forEach(s=>{s===t?(s.classList.add("active"),document.querySelectorAll(".product-color-name").forEach(n=>{n.textContent="#"+t.dataset.color})):s.classList.remove("active")});const i=t.dataset.productImgLabel;if(i){const s=document.querySelector('.dot[data-product-img-label="'+i+'"]');s&&s.click();const n=h=>h.parentNode.style.display="block",u=h=>h.parentNode.style.display="none",f=document.querySelectorAll('img[data-product-img-label="'+i+'"]');f.length==0?document.querySelectorAll("img[data-product-img-label]").forEach(n):(document.querySelectorAll("img[data-product-img-label]").forEach(u),f.forEach(n)),f.length<=10?document.querySelectorAll(".gallery").forEach(h=>h.style.columns=1):document.querySelectorAll(".gallery").forEach(h=>h.style.removeProperty("columns"))}document.querySelectorAll("[data-product-size]").forEach(s=>{let n=s.dataset.productSize;o.includes(n)?(s.classList.remove("text-bg-light","deactive"),s.classList.add("text-bg-dark")):(s.classList.add("text-bg-light","deactive"),s.classList.remove("text-bg-dark"))})},P=e=>typeof e=="string"&&e.trim().replaceAll("'","%27").replaceAll('"',"%22")||"",X=async(e,t)=>{const o=e.querySelector(".mine-circle-fill");o&&o.click(),t.ThisProductUrl=location.href,t.IsMobile=navigator&&navigator.userAgent&&/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),t.CanBack=window.history.length>=2;const i=t,s=l=>e.querySelectorAll(l),n=(l,c)=>s(l).forEach(c),u=(l,c)=>{const a=typeof c=="function"?c:d=>d;return d=>{const m=a(d,d.getAttribute(l));return d.removeAttribute(l),m}};n("[j-set]",u("j-set",(l,c)=>{const a=c.split("=");l.setAttribute(a[0],i[a[1]])})),n("[j-set-url]",u("j-set-url",(l,c)=>{const a=c.split("="),d=P(i[a[1]]);l.setAttribute(a[0],d)})),n("[j-set-html]",u("j-set-html",(l,c)=>l.innerHTML=i[c]||"")),(l=>{const c=[];n(":not(iframe):not(script):not(style):not(br):not(img):not(input)",d=>d.childNodes.forEach(m=>{m.nodeType!==Node.TEXT_NODE||!m.nodeValue.match(/\[\[\s*(.*?)\s*\]\]/)||c.push(m)}));const a={};c.forEach(d=>{const m=d.nodeValue;let E=m;for(const w of m.matchAll(/\[\[\s*(.*?)\s*\]\]/gm)){const y=w[0];if(!a[y]){const L=l[w[1]];a[y]=L??""}E=E.replace(y,a[y])}d.nodeValue=E})})(i);const h=l=>l.parentNode.removeChild(l),r=(l,c)=>u(l,(a,d)=>c[d]?(a.removeAttribute(l),d):(h(a),!1)),v=l=>{const c=[];if(!l.parentNode)return c;let a=l.parentNode.firstChild;for(;a;)a.nodeType===1&&a!==l&&c.push(a),a=a.nextSibling;return c},C=r("j-if",i),q=r("j-else-if",i);n("[j-if]",l=>{const c=v(l);let a=C(l)!==!1,d=null;c.forEach(m=>{if(m.hasAttribute("j-else")){d=m;return}m.hasAttribute("j-else-if")&&(a?h(m):a=q(m)!==!1)}),!a&&d&&d.removeAttribute("j-else")})},$=()=>window.matchMedia&&window.matchMedia("(max-width: 736px)").matches,x=e=>{e.preventDefault();const t=S(e.target,s=>!!s.dataset.url);let o=t&&t.dataset.url;if(!o)return;if(o="/"+o,$()){window.location.href=o;return}const i=document.querySelector(".img-full-page");i&&(i.innerHTML=`<iframe src="${o}" class="size-guide-inside-page">你的瀏覽器不支援 iframe,請點擊<a href="${o}">這裡</a></iframe>`,i.style.removeProperty("background-image"),i.style.display="block")},Y=e=>{e.preventDefault(),window.open("fb-messenger://share?link="+encodeURIComponent(window.location.href))},_=async e=>{window.onClickProductColor=N,window.showInsideWindowByUrl=x,window.shareToMessenger=Y,await X(e,{})},z={init:_};let p=1;function b(e){A(p+=e)}function T(e){A(p=e)}function A(e){let t;const o=document.getElementsByClassName("mySlides");if(o.length)for(e>o.length&&(p=1),e<1&&(p=o.length),t=0;t<o.length;t++){const s=o[t];s.style.display="none"}const i=document.getElementsByClassName("dot");if(i.length)for(t=0;t<i.length;t++)i[t].classList.remove("active");if(o.length){const s=o[p-1];s.style.display="block"}i.length&&i[p-1].classList.add("active")}const g={endX:0,endY:0,startX:0,startY:0};function B(e,t){g.endX=e,g.endY=t}function D(e,t){g.startX=e,g.startY=t}function H(){g.endX<g.startX?b(1):g.endX>g.startX&&b(-1)}window.plusSlides=b;window.currentSlide=T;const k=e=>{let t=e.target;if(!t)return;if(t.tagName!="IMG"){const n=t.querySelector("img");if(!n)return;t=n}const o=t,i=o&&o.src;if(!i)return;const s=document.querySelector(".img-full-page");s&&(s.innerHTML=`<div class="zoom-for-fullscreen"><img draggable="false" src="${i}" alt="image"></div>`,s.style.display="block",I.setScale(2).setImg(s.querySelector("img")))};function M(){document.querySelectorAll(".mySlides").forEach(e=>{e.addEventListener("touchstart",t=>{const o=t;D(o.changedTouches[0].screenX,o.changedTouches[0].screenY)},{passive:!0}),e.addEventListener("touchend",t=>{const o=t;B(o.changedTouches[0].screenX,o.changedTouches[0].screenY),H()},{passive:!0}),e.addEventListener("click",k)})}z.init(document.body).then(()=>{T(1),M(),j(jQuery,k)});
